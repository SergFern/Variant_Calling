#!/usr/bin/env nextflow

process.container = '../GermlineSingularity/GermlineApps/' 
// Image is called specifically for this directory structure, susceptible of change in the future
singularity.enabled = true
cleanup = false

params{
  
  // Params for debugging -----------------------

  skipMain = false

}

params {

    //General params---------------------------

    working_dir = "~/Variant_Calling"

    indir = "data"
    outdir = "my-results"

    //scripts_dir = "scripts" //<- currently not using modules
 
    //Setting Directories---------------------

    singularity_dir = "~/GermlineSingularity/GermlineApps"
    BBDD_dir = "${params.singularity_dir}/home/BBDD/Homo_sapiens"
    GRCh37_dir = "${params.BBDD_dir}/Ensembl/GRCh37/Sequence"
    GRCh38_dir = "${params.BBDD_dir}/NCBI/GRCh38/Sequence"
    threads = 1

}

params {
  
  //Quality check params //--------------------------------------------------------

  java_mem = '4G'

  tagFastQC = false
  tagBam = false
}

params {

  // Parameters for trimming process. //--------------------------------------------------------

    // Are reads paired or single end
    //Default:
    paired = true 

    if(params.paired){ //We currently have two methods to select our data inputs
        reads = "${params.indir}/*_R{1,2}_*.fastq.gz"
    }else{reads = "${params.indir}/files.csv"}
 
   adapter_file = 'NO_FILE'
   adapter_trimm = "${params.indir}/${params.adapter_file}"

   minlen = 20
   minqual = 20
}

params {

  // Parameters for Mapping //--------------------------------------------------------

    // Defaults:
    aln = "bwa"
    prefix = "out" //prefix for output file
    platform = "ILLUMINA"
    genome = "GRCh37"
    RG = ''
    indexRef = ''
    region_intervals = 'NO_FILE'
    GVCFmode = 'false'

    if(params.genome == "GRCh37"){ //--------------------------------------------------------
      if(params.aln == "bwa"){
          indexRef = "${params.GRCh37_dir}/BWAIndex/genome.fa"
          RG = "@RG\\tID:${params.prefix}\\tSM:${params.prefix}\\tPL:${params.platform}"
          //indexRef = "${params.working_dir}/${params.GRCh37_dir}/BWAIndex/genome.fa"
      }else if(params.aln == "bowtie2"){
          //indexRef = "${params.working_dir}/${params.GRCh37_dir}/Bowtie2Index/genome"
          indexRef = "${params.GRCh37_dir}/Bowtie2Index/genome"
          RG = " --rg-id ${params.prefix} --rg SM:${params.prefix} --rg PL:${params.platform}"
      }

      seqRef = "${params.GRCh37_dir}/WholeGenomeFasta/genome.fa"

    }else if(params.genome == "GRCh38"){ //--------------------------------------------------------

      if(params.aln == "bwa"){
          indexRef = "${params.GRCh38_dir}/BWAIndex/genome.fa"
          RG = "@RG\\tID:${params.prefix}\\tSM:${params.prefix}\\tPL:${params.platform}"
          //indexRef = "${params.working_dir}/${params.GRCh38_dir}/BWAIndex/genome.fa"
      }else if(params.aln == "bowtie2"){
          //indexRef = "${params.working_dir}/${params.GRCh38_dir}/Bowtie2Index/genome"
          indexRef = "${params.GRCh38_dir}/Bowtie2Index/genome"
          RG = " --rg-id ${params.prefix} --rg SM:${params.prefix} --rg PL:${params.platform}"
      }

      seqRef = "${params.GRCh38_dir}/WholeGenomeFasta/genome.fa"


    }
    mappingOptions = ""
    remove_duplicates = false
    mapping_intervals = "NO_FILE"

}

params {
  
  //Parameters for Recalibration //--------------------------------------------------------
  //Default:
  dbSNP = ''

  if(params.genome == "GRCh37"){

  dbSNP ='~/GermlineSingularity/GermlineApps/home/BBDD/Homo_sapiens/dbSNP/GRCh37/common_all_20180418.vcf'
  dbSNP_index = "${params.BBDD_dir}/dbSNP/${params.genome}/common_all_20180418.vcf.idx"

}else if(params.genome == "GRCh38"){

  dbSNP ='~/GermlineSingularity/GermlineApps/home/BBDD/Homo_sapiens/dbSNP/GRCh38/common_all_20180418.vcf'

  }
}

params {
  
  //Parameters for Variant calling //--------------------------------------------------------
  //Defaults:

  maped_reads = "${params.outdir}/alignment/*bqsr{.bam,.bai}"
  vc = "gatk"
  vcOpts = ""
  rmDups_GATK = ""

  if(params.vc == "gatk"){
    if(params.remove_duplicates == false){
      rmDups_GATK = "--disable-read-filter NotDuplicateReadFilter"
    }
  }

}